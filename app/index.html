<!DOCTYPE html>
<html>
  <head>
    
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.js"></script>    

    <script src="build/react.js"></script>
    <script src="build/JSXTransformer.js"></script>

    <script type="text/jsx" src="datepicker.jsx"></script>

    <link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css" />
    <link type="text/css" href="styles/datepicker.css" rel="stylesheet" />
    <link type="text/css" href="styles/style.css" rel="stylesheet" />
  </head>
  <body>

    <div class="container">
        <div id="new-apart-form"></div>
        <div id="date-filters"></div>
        <div id="aparts-list"></div>
    </div>

    <script type="text/jsx">
      /** @jsx React.DOM */

      var NewApartForm = React.createClass({
          postNewApart: function(apart_id) {
            $.post("/rest/apart?apart_id=" + apart_id)
            .done(function(data) {
              console.log("SUCCESS");
            })
            .fail(function(data) {
              console.log("FAIL");
            })
          },
          handleSubmit: function(e) {
            //e.preventDefault();
            var apart_id = this.refs.apart_id.getDOMNode().value.trim();
            if (!apart_id) {
              return false;
            }
            console.log("APART ID " + apart_id);
            // post new apart
            this.postNewApart(apart_id);
            // clear form
            this.refs.apart_id.getDOMNode().value = '';
            return false;
          },
          render: function() {
            return (
              <form className="apartForm" onSubmit={this.handleSubmit}>
                <input 
                  type="text" 
                  placeholder="Nueva Referencia Apartamento Homelidays"
                  ref="apart_id" />
                <input type="submit" value="Post" className="btn btn-primary" />
              </form>
            );
          }
      });
      
      var Apart = React.createClass({

          getInitialState: function() {
            return {reservations:{}};
          },

          render: function() {
            var apart = this.props.apart;
                image = apart.data.property.imageUrls[0];
            return (<div className="apart">
                      <img className="apart-img" src={image} />
                      <h3 className="apart-id" >Referencia: {apart.id}</h3>
                      <MonthBar
                        reservations={apart.reserved} />
                    </div>);
          }
      });
    
      var Aparts = React.createClass({

          loadAparts: function() {
            $.get("../rest/apart/list")
            .done(function(aparts) {
              this.setState({aparts: $.parseJSON(aparts)});
            }.bind(this))
            .fail(function(xhr, status, err) {
                console.error(this.props.url, status, err.toString());
            }.bind(this));
          },

          getInitialState: function() {
            return {aparts:[]};
          },

          componentDidMount: function() {
            this.loadAparts();
          },

          render: function() {
            var aparts = this.state.aparts.map(function(apart){
                apart.reserved = $.parseJSON(apart.reserved);
                apart.data = $.parseJSON(apart.data);
                return (<Apart apart={apart} />);
            }.bind(this));

            return (<div>
                      {aparts}
                    </div>);
          }
      });

      var DateFilter = React.createClass( {

          render: function() {
            return (<div className="date-filters">
                      <div className="date-filter">
                        <DatePickerInput className="date-filter" />
                      </div>
                      <div className="date-filter">
                        <DatePickerInput className="date-filter" />
                      </div>
                    </div>);
          }
      });

      React.renderComponent(
        <Aparts />,
        document.getElementById('aparts-list')
      );

      React.renderComponent(<DateFilter />,
        document.getElementById('date-filters')
      );

    </script>

  </body>
</html>